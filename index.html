<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Tactical Map PRO</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { height:100%; font-family:system-ui; overflow:hidden; }
  #map { width:100%; height:100%; z-index:1; }

  /* Header */
  .header { position:absolute; top:0; left:0; right:0; height:50px;
    background:rgba(31,41,55,0.95); color:white; z-index:1001;
    display:flex; justify-content:space-between; align-items:center;
    padding:0 10px; border-bottom:1px solid #374151; backdrop-filter:blur(10px);
  }
  .header-left { display:flex; align-items:center; gap:8px; }
  .header-title { font-weight:bold; font-size:14px; }
  .header-subtitle { font-size:10px; color:#9ca3af; }
  .btn { padding:6px 10px; background:#374151; border:none; border-radius:4px; color:white; cursor:pointer; font-size:18px; }
  .btn:hover { background:#4b5563; }
  .btn:active { background:#6b7280; }

  /* Layer Selector */
  .layer-selector { position:absolute; top:60px; right:10px; background:rgba(31,41,55,0.95); color:white;
    padding:8px; border-radius:8px; z-index:1000; backdrop-filter:blur(10px); display:none;
  }
  .layer-selector.open { display:block; }
  .layer-btn { padding:8px 12px; margin:4px 0; width:100%; background:#374151; border:none; color:white; border-radius:4px; cursor:pointer; font-size:12px; }
  .layer-btn:hover { background:#4b5563; }
  .layer-btn.active { background:#10b981; }

  /* GPS Status */
  .gps-status { position:absolute; bottom:20px; left:10px; background:rgba(31,41,55,0.95); color:white;
    padding:8px 12px; border-radius:8px; font-size:11px; z-index:1000; backdrop-filter:blur(10px);
  }
  .gps-dot { display:inline-block; width:8px; height:8px; border-radius:50%; margin-right:6px; }
  .gps-dot.active { background:#10b981; }
  .gps-dot.inactive { background:#ef4444; }

  /* Mirino */
  .crosshair {
    position:absolute;
    width:30px; height:30px;
    top:50%; left:50%;
    margin-left:-15px; margin-top:-15px;
    pointer-events:none;
    z-index:1000;
  }
  .crosshair:before, .crosshair:after {
    content:'';
    position:absolute;
    background:#ef4444;
  }
  .crosshair:before { left:50%; top:0; width:2px; height:100%; margin-left:-1px; }
  .crosshair:after { top:50%; left:0; height:2px; width:100%; margin-top:-1px; }

</style>
</head>
<body>
<div id="map"></div>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <span style="font-size:20px;">üéØ</span>
    <div>
      <div class="header-title">TACTICAL MAP PRO</div>
      <div class="header-subtitle">ALPHA-1</div>
    </div>
  </div>
  <div style="display:flex;gap:8px;">
    <button class="btn" onclick="toggleLayers()" title="Mappe">üó∫Ô∏è</button>
  </div>
</div>

<!-- Layer Selector -->
<div class="layer-selector" id="layerSelector">
  <button class="layer-btn active" onclick="changeMap('street', this)">üó∫Ô∏è Street</button>
  <button class="layer-btn" onclick="changeMap('satellite', this)">üõ∞Ô∏è Satellite</button>
  <button class="layer-btn" onclick="changeMap('topo', this)">‚õ∞Ô∏è Topografica</button>
  <button class="layer-btn" onclick="changeMap('dark', this)">üåô Dark</button>
</div>

<!-- GPS Status -->
<div class="gps-status">
  <span class="gps-dot inactive" id="gpsDot"></span>
  <span id="gpsStatus">GPS: Ricerca...</span>
</div>

<!-- Mirino -->
<div class="crosshair"></div>

<script>
let map;
let tileLayer;
let gpsActive = false;

// Inizializza mappa
function initMap() {
  map = L.map('map', { zoomControl:true, attributionControl:true }).setView([41.9028,12.4964],6);

  tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom:19,
    attribution:'¬© OpenStreetMap'
  }).addTo(map);
}

// Cambio layer
function changeMap(type, btn) {
  document.querySelectorAll('.layer-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');

  if(tileLayer) map.removeLayer(tileLayer);

  switch(type) {
    case 'street':
      tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'¬© OSM'}).addTo(map);
      break;
    case 'satellite':
      tileLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
        maxZoom:20,
        subdomains:['mt0','mt1','mt2','mt3']
      }).addTo(map);
      break;
    case 'topo':
      tileLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17, attribution:'¬© OpenTopoMap'}).addTo(map);
      break;
    case 'dark':
      tileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{maxZoom:19, attribution:'¬© Carto'}).addTo(map);
      break;
  }

  // Chiudi layer selector quando selezioni
  document.getElementById('layerSelector').classList.remove('open');
}

// Toggle layer selector
function toggleLayers() {
  document.getElementById('layerSelector').classList.toggle('open');
}

// Inizializza GPS
function initGPS() {
  if(!navigator.geolocation) {
    alert("‚ùå GPS non supportato");
    return;
  }

  navigator.geolocation.watchPosition(
    (pos)=>{
      gpsActive = true;
      document.getElementById('gpsDot').classList.add('active');
      document.getElementById('gpsDot').classList.remove('inactive');
      document.getElementById('gpsStatus').textContent = "GPS: Attivo";

      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      // Centra mappa
      map.setView([lat,lng], map.getZoom());
    },
    (err)=>{
      gpsActive = false;
      document.getElementById('gpsDot').classList.remove('active');
      document.getElementById('gpsDot').classList.add('inactive');
      document.getElementById('gpsStatus').textContent = "GPS: Non rilevato";
      console.error(err);
    },
    { enableHighAccuracy:true, timeout:20000, maximumAge:0 }
  );
}

initMap();
initGPS();

</script>
</body>
</html>
