<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tactical Map PRO</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; font-family:system-ui; overflow:hidden; }
#map { width:100%; height:100%; z-index:1; }

/* Header */
.header {
    position:absolute; top:0; left:0; right:0; height:50px;
    background:rgba(31,41,55,0.95); color:white; z-index:1001;
    display:flex; justify-content:space-between; align-items:center;
    padding:0 10px; border-bottom:1px solid #374151; backdrop-filter:blur(10px);
}
.header-left { display:flex; align-items:center; gap:8px; }
.header-title { font-weight:bold; font-size:14px; }
.header-subtitle { font-size:10px; color:#9ca3af; }
.btn {
    padding:6px 10px; background:#374151; border:none;
    border-radius:4px; color:white; cursor:pointer; font-size:18px;
}
.btn:hover { background:#4b5563; }
.btn:active { background:#6b7280; }

/* Info Panel */
.info-panel {
    position:absolute; top:60px; left:10px; right:10px;
    background:rgba(31,41,55,0.98); color:white;
    padding:12px; border-radius:8px; z-index:1000;
    border:1px solid #374151; max-width:400px;
    backdrop-filter:blur(10px);
}
.info-row { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:8px; }
.info-label { font-size:10px; color:#9ca3af; margin-bottom:4px; }
select, input, textarea {
    width:100%; padding:6px; background:#374151; border:1px solid #4b5563;
    border-radius:4px; color:white; font-size:12px;
}
.info-value {
    font-family:monospace; font-size:11px; color:#10b981;
    background:#111827; padding:8px; border-radius:4px;
    border:1px solid #374151; margin-bottom:8px; word-break:break-all;
}
.info-stats { background:#111827; padding:8px; border-radius:4px; border:1px solid #374151; }
.info-stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
.info-stat-label { font-size:9px; color:#9ca3af; }
.info-stat-value { font-family:monospace; font-size:11px; font-weight:bold; }

/* Controls */
.controls {
    position:absolute; bottom:20px; right:10px;
    display:flex; flex-direction:column; gap:8px; z-index:1000;
}
.control-btn {
    width:50px; height:50px; border-radius:50%;
    background:#374151; border:none; color:white;
    font-size:24px; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,0.5);
}
.control-btn:hover { background:#4b5563; }
.control-btn:active { background:#6b7280; }
.control-btn.active { background:#10b981; animation:pulse 2s infinite; }

@keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }

/* Menu */
.menu {
    position:absolute; right:0; top:50px; bottom:0; width:90%;
    max-width:320px; background:rgba(31,41,55,0.98); color:white;
    padding:16px; overflow-y:auto; transform:translateX(100%);
    transition:transform 0.3s; z-index:1001;
    border-left:1px solid #374151; backdrop-filter:blur(10px);
}
.menu.open { transform:translateX(0); }
.menu-section { margin-bottom:24px; }
.menu-title { font-weight:bold; margin-bottom:12px; font-size:14px; }
.marker-item {
    background:#374151; padding:12px; border-radius:8px;
    margin-bottom:8px; cursor:pointer;
}
.marker-item:hover { background:#4b5563; }
.marker-item:active { background:#6b7280; }

/* Compass */
.compass {
    position:absolute; top:220px; right:10px;
    width:64px; height:64px; z-index:1000;
}
.compass-circle {
    width:100%; height:100%; border-radius:50%;
    background:rgba(31,41,55,0.95); border:2px solid #4b5563;
    position:relative; backdrop-filter:blur(10px);
}
.compass-needle {
    position:absolute; top:6px; left:50%; width:0; height:0; margin-left:-6px;
    border-left:6px solid transparent; border-right:6px solid transparent;
    border-bottom:14px solid #ef4444; transform-origin:6px 26px;
}
.compass-n {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    font-weight:bold; font-size:12px;
}
.compass-value {
    position:absolute; top:68px; left:50%; transform:translateX(-50%);
    font-size:10px; font-family:monospace; color:#fbbf24;
    background:rgba(17,24,39,0.9); padding:3px 8px; border-radius:4px;
    white-space:nowrap; backdrop-filter:blur(10px);
}

/* Loading */
.loading {
    position:fixed; inset:0; background:rgba(17,24,39,0.95);
    display:flex; align-items:center; justify-content:center;
    z-index:2000; flex-direction:column; backdrop-filter:blur(10px);
}
.loading.hidden { display:none; }
@keyframes spin { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
.spin { animation:spin 2s linear infinite; }

/* GPS Status */
.gps-status {
    position:absolute; bottom:20px; left:10px;
    background:rgba(31,41,55,0.95); color:white;
    padding:8px 12px; border-radius:8px; font-size:11px;
    z-index:1000; backdrop-filter:blur(10px);
}
.gps-dot {
    display:inline-block; width:8px; height:8px;
    border-radius:50%; margin-right:6px;
}
.gps-dot.active { background:#10b981; animation:pulse 2s infinite; }
.gps-dot.inactive { background:#ef4444; }

/* Layer Selector */
.layer-selector {
    position:absolute; top:60px; right:10px;
    background:rgba(31,41,55,0.95); color:white;
    padding:8px; border-radius:8px; z-index:1000;
    backdrop-filter:blur(10px); display:none;
}
.layer-selector.open { display:block; }
.layer-btn {
    padding:8px 12px; margin:4px 0; width:100%;
    background:#374151; border:none; color:white;
    border-radius:4px; cursor:pointer; font-size:12px;
}
.layer-btn:hover { background:#4b5563; }
.layer-btn.active { background:#10b981; }

/* Mirino */
.crosshair {
    position:absolute; width:20px; height:20px; border:2px solid red;
    border-radius:50%; z-index:999; pointer-events:none;
    transform:translate(-50%,-50%);
}
</style>
</head>
<body>
<div id="map"></div>

<!-- Header -->
<div class="header">
    <div class="header-left">
        <span style="font-size:20px;">üéØ</span>
        <div>
            <div class="header-title">TACTICAL MAP PRO</div>
            <div class="header-subtitle">ALPHA-1</div>
        </div>
    </div>
    <div style="display:flex;gap:8px;">
        <button class="btn" onclick="toggleLayers()">üó∫Ô∏è</button>
        <button class="btn" onclick="toggleMenu()">‚ò∞</button>
    </div>
</div>

<!-- Layer Selector -->
<div class="layer-selector" id="layerSelector">
    <button class="layer-btn active" onclick="changeMap('street')">üó∫Ô∏è Street</button>
    <button class="layer-btn" onclick="changeMap('satellite')">üõ∞Ô∏è Satellite</button>
</div>

<!-- GPS Status -->
<div class="gps-status">
    <span class="gps-dot inactive" id="gpsDot"></span>
    <span id="gpsStatus">GPS: Ricerca...</span>
</div>

<!-- Controls -->
<div class="controls">
    <button class="control-btn" onclick="centerGPS()">üß≠</button>
</div>

<!-- Mirino -->
<div class="crosshair" id="crosshair" style="display:none;"></div>

<!-- Loading -->
<div class="loading" id="loading">
    <div style="font-size:64px;margin-bottom:16px;" class="spin">üõ∞Ô∏è</div>
    <div style="font-size:20px;font-weight:bold;margin-bottom:8px;color:white;">Inizializzazione GPS...</div>
    <div style="font-size:14px;color:#9ca3af;">Attendi connessione satelliti</div>
</div>

<script>
// MAPPA
let map = L.map('map', {zoomControl:false}).setView([41.9028,12.4964], 6);
let baseLayers = {
    street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, attribution:'¬© OpenStreetMap'}).addTo(map),
    satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {maxZoom:19, attribution:'¬© ESRI'})
};
let currentLayer = 'street';

// Layer selector
function toggleLayers(){ let sel=document.getElementById('layerSelector'); sel.classList.toggle('open'); }
function changeMap(layer){ if(layer===currentLayer) return; map.removeLayer(baseLayers[currentLayer]); baseLayers[layer].addTo(map); currentLayer=layer; document.querySelectorAll('.layer-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); document.getElementById('layerSelector').classList.remove('open'); }

// GPS
let userMarker=null, userCircle=null;
function initGPS(){
    if(!navigator.geolocation){ alert('GPS non supportato'); return; }
    navigator.geolocation.watchPosition(updateUserLocation, err=>{console.error(err); alert('Errore GPS');},{enableHighAccuracy:true, maximumAge:5000});
}
function updateUserLocation(pos){
    let lat=pos.coords.latitude, lng=pos.coords.longitude, acc=pos.coords.accuracy;
    document.getElementById('gpsStatus').textContent='GPS: Attivo';
    document.getElementById('gpsDot').classList.add('active'); document.getElementById('gpsDot').classList.remove('inactive');
    document.getElementById('loading').classList.add('hidden');
    if(!userMarker){
        userMarker=L.marker([lat,lng]).addTo(map);
        userCircle=L.circle([lat,lng],{radius:acc, color:'#3b82f6', fillOpacity:0.1}).addTo(map);
        map.setView([lat,lng],16);
    }else{
        userMarker.setLatLng([lat,lng]);
        userCircle.setLatLng([lat,lng]); userCircle.setRadius(acc);
    }
}
function centerGPS(){ if(userMarker) map.setView(userMarker.getLatLng(),16); }

// Mirino
let crosshair=document.getElementById('crosshair');
map.on('click', e=>{
    crosshair.style.display='block';
    crosshair.style.left=e.containerPoint.x+'px';
    crosshair.style.top=e.containerPoint.y+'px';
});

// Menu
let menu=document.getElementById('layerSelector');
map.on('zoomstart', ()=>{ menu.classList.remove('open'); });

// Avvio
initGPS();
</script>
</body>
</html>
