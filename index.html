<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tactical Map PRO</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  html,body{height:100%;font-family:system-ui;overflow:hidden;}
  #map{width:100%;height:100%;z-index:1;}
  .header{position:absolute;top:0;left:0;right:0;height:50px;background:rgba(31,41,55,0.95);color:white;z-index:1001;display:flex;justify-content:space-between;align-items:center;padding:0 10px;border-bottom:1px solid #374151;backdrop-filter:blur(10px);}
  .header-left{display:flex;align-items:center;gap:8px;}
  .header-title{font-weight:bold;font-size:14px;}
  .header-subtitle{font-size:10px;color:#9ca3af;}
  .btn{padding:6px 10px;background:#374151;border:none;border-radius:4px;color:white;cursor:pointer;font-size:18px;}
  .btn:hover{background:#4b5563;}
  .btn:active{background:#6b7280;}
  .info-panel{position:absolute;top:60px;left:10px;right:10px;background:rgba(31,41,55,0.98);color:white;padding:12px;border-radius:8px;z-index:1000;border:1px solid #374151;max-width:400px;backdrop-filter:blur(10px);}
  .info-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;}
  .info-label{font-size:10px;color:#9ca3af;margin-bottom:4px;}
  select,input,textarea{width:100%;padding:6px;background:#374151;border:1px solid #4b5563;border-radius:4px;color:white;font-size:12px;}
  .info-value{font-family:monospace;font-size:11px;color:#10b981;background:#111827;padding:8px;border-radius:4px;border:1px solid #374151;margin-bottom:8px;word-break:break-all;}
  .info-stats{background:#111827;padding:8px;border-radius:4px;border:1px solid #374151;}
  .info-stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
  .info-stat-label{font-size:9px;color:#9ca3af;}
  .info-stat-value{font-family:monospace;font-size:11px;font-weight:bold;}
  .controls{position:absolute;bottom:20px;right:10px;display:flex;flex-direction:column;gap:8px;z-index:1000;}
  .control-btn{width:50px;height:50px;border-radius:50%;background:#374151;border:none;color:white;font-size:24px;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,0.5);}
  .control-btn:hover{background:#4b5563;}
  .control-btn:active{background:#6b7280;}
  .gps-status{position:absolute;bottom:20px;left:10px;background:rgba(31,41,55,0.95);color:white;padding:8px 12px;border-radius:8px;font-size:11px;z-index:1000;backdrop-filter:blur(10px);}
  .gps-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px;}
  .gps-dot.active{background:#10b981;}
  .gps-dot.inactive{background:#ef4444;}
</style>
</head>
<body>
<div id="map"></div>

<div class="header">
  <div class="header-left">
    <span style="font-size:20px;">üéØ</span>
    <div>
      <div class="header-title">TACTICAL MAP PRO</div>
      <div class="header-subtitle">ALPHA-1</div>
    </div>
  </div>
  <div style="display:flex;gap:8px;">
    <button class="btn" onclick="toggleLayers()">üó∫Ô∏è</button>
  </div>
</div>

<div class="info-panel" id="infoPanel">
  <div class="info-row">
    <div>
      <div class="info-label">Datum</div>
      <select id="datum"><option value="wgs84">WGS 84</option></select>
    </div>
    <div>
      <div class="info-label">Formato</div>
      <select id="coordFormat" onchange="updateCoords()"><option value="dd">DD</option></select>
    </div>
  </div>
  <div class="info-value" id="coordsDisplay">Attendi GPS...</div>
  <div class="info-row">
    <div>
      <div class="info-label">Nord Ref</div>
      <select id="northRef"><option value="true">Geografico</option></select>
    </div>
    <div>
      <div class="info-label">Azimut</div>
      <select id="azFormat"><option value="degrees">Gradi (360¬∞)</option></select>
    </div>
  </div>
  <div class="info-stats">
    <div class="info-stats-grid">
      <div><div class="info-stat-label">Az</div><div class="info-stat-value" id="azValue">--</div></div>
      <div><div class="info-stat-label">Acc</div><div class="info-stat-value" id="accValue">--</div></div>
      <div><div class="info-stat-label">Alt</div><div class="info-stat-value" id="altValue">--</div></div>
      <div><div class="info-stat-label">Vel</div><div class="info-stat-value" id="velValue">--</div></div>
    </div>
  </div>
</div>

<div class="gps-status">
  <span class="gps-dot inactive" id="gpsDot"></span>
  <span id="gpsStatus">GPS: Ricerca...</span>
</div>

<div class="controls">
  <button class="control-btn" onclick="centerGPS()" title="GPS">üß≠</button>
</div>

<script>
// --- MAPPA ---
let map = L.map('map', {zoomControl:true}).setView([41.9028,12.4964],6);

const mapLayers = {
  street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'¬© OpenStreetMap'}),
  satellite: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17,attribution:'¬© OpenTopoMap'}),
  dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{maxZoom:19,attribution:'&copy; CARTO'}),
  topo: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17,attribution:'¬© OpenTopoMap'})
};
mapLayers.street.addTo(map);
function changeMap(layer){Object.values(mapLayers).forEach(l=>map.removeLayer(l));mapLayers[layer].addTo(map);}

// --- GPS ---
let userMarker=null,userLocation=null,userCircle=null,gpsActive=false;
function initGPS(){
  if(!navigator.geolocation){simulateGPS();return;}
  navigator.geolocation.getCurrentPosition(pos=>{
    gpsActive=true;
    updateUserLocation(pos);
    navigator.geolocation.watchPosition(updateUserLocation,simulateGPS,{enableHighAccuracy:true,timeout:15000,maximumAge:5000});
  },simulateGPS,{enableHighAccuracy:true,timeout:10000,maximumAge:0});
}

function updateUserLocation(pos){
  userLocation={lat:pos.coords.latitude,lng:pos.coords.longitude,accuracy:pos.coords.accuracy,altitude:pos.coords.altitude,speed:pos.coords.speed,heading:pos.coords.heading};
  if(!userMarker){
    userMarker=L.marker([userLocation.lat,userLocation.lng],{icon:L.divIcon({html:'<div style="width:16px;height:16px;background:#3b82f6;border:3px solid white;border-radius:50%;box-shadow:0 0 15px rgba(59,130,246,0.8);"></div>',className:'',iconSize:[22,22],iconAnchor:[11,11]})}).addTo(map);
    userCircle=L.circle([userLocation.lat,userLocation.lng],{radius:userLocation.accuracy,color:'#3b82f6',fillColor:'#3b82f6',fillOpacity:0.1,weight:1}).addTo(map);
    map.setView([userLocation.lat,userLocation.lng],16);
  } else {
    userMarker.setLatLng([userLocation.lat,userLocation.lng]);
    userCircle.setLatLng([userLocation.lat,userLocation.lng]);
    userCircle.setRadius(userLocation.accuracy);
  }
  document.getElementById('coordsDisplay').textContent=`${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}`;
  document.getElementById('accValue').textContent=`¬±${Math.round(userLocation.accuracy)}m`;
  document.getElementById('altValue').textContent=userLocation.altitude?Math.round(userLocation.altitude)+'m':'N/A';
  document.getElementById('velValue').textContent=userLocation.speed?(userLocation.speed*3.6).toFixed(1)+' km/h':'0 km/h';
  document.getElementById('gpsDot').classList.add('active');
  document.getElementById('gpsDot').classList.remove('inactive');
  document.getElementById('gpsStatus').textContent='GPS: Attivo';
}

function simulateGPS(){
  const pos={coords:{latitude:41.9028,longitude:12.4964,accuracy:10,altitude:30,speed:0,heading:0}};
  updateUserLocation(pos);
  gpsActive=true;
  document.getElementById('gpsStatus').textContent='GPS simulato';
}

function centerGPS(){if(userLocation)map.setView([userLocation.lat,userLocation.lng],16);}

// --- Layer toggle ---
function toggleLayers(){
  const sel=prompt('Scegli layer: street, satellite, dark, topo','street');
  if(sel&&mapLayers[sel])changeMap(sel);
}

// --- INIT ---
initGPS();
</script>
</body>
</html>
